import { AbortError, isAborted, } from './utils';
import { isTensor, } from '@upscalerjs/core';
import { tf, } from './dependencies.generated';
export const makeTick = (signal, awaitNextFrame) => async (result) => {
    if (awaitNextFrame) {
        await tf.nextFrame();
    }
    if (isAborted(signal)) {
        if (Array.isArray(result)) {
            result.forEach(r => r?.dispose());
        }
        else if (isTensor(result)) {
            result.dispose();
        }
        throw new AbortError();
    }
};
